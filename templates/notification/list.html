{% extends "base.html" %}
{% block title %}我的通知{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center py-3">
            <h5 class="mb-0">
                <i class="bi bi-bell-fill me-2"></i>我的通知
            </h5>
            <div class="d-flex align-items-center gap-2">
                {% set unread_count = notifications|selectattr('is_read', 'equalto', false)|list|length %}
                {% if unread_count > 0 %}
                <form action="{{ url_for('notification.read_all') }}" method="POST" class="m-0">
                    <button type="submit" class="btn btn-sm btn-outline-light rounded-pill">
                        <i class="bi bi-check2-all"></i> 一键已读
                    </button>
                </form>
                {% endif %}
                <span class="badge rounded-pill bg-light text-primary">
                    {{ unread_count }} 未读
                </span>
            </div>
        </div>

        <div class="card-body p-0">
            {% if notifications %}
            
            <div class="table-responsive d-none d-md-block">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width:160px;" class="ps-4">时间</th>
                            <th style="width:200px;">标题</th>
                            <th>通知内容</th>
                            <th style="width:100px;" class="text-center">状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for notify in notifications %}
                        <tr onclick="window.location='{{ url_for('notification.mark_as_read', notify_id=notify.id) if not notify.is_read else '#' }}'"
                            style="cursor:pointer;">
                            <td class="text-muted small ps-4">{{ notify.created_at.strftime('%Y-%m-%d %H:%M') if notify.created_at }}</td>
                            <td>
                                <span class="fw-bold {% if not notify.is_read %}text-dark{% else %}text-muted{% endif %}">
                                    {{ notify.title }}
                                </span>
                            </td>
                            <td>
                                <div class="small text-secondary" style="max-width: 800px;">
                                    {{ notify.content|striptags }}
                                </div>
                            </td>
                            <td class="text-center">
                                {% if not notify.is_read %}
                                <span class="badge bg-danger">未读</span>
                                {% else %}
                                <span class="badge bg-light text-muted border">已读</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="d-block d-md-none">
                <div class="list-group list-group-flush">
                    {% for notify in notifications %}
                    <a href="{{ url_for('notification.mark_as_read', notify_id=notify.id) if not notify.is_read else 'javascript:void(0);' }}" 
                       class="list-group-item list-group-item-action p-3 {% if not notify.is_read %}bg-light-blue{% endif %}">
                        <div class="d-flex w-100 justify-content-between align-items-center mb-1">
                            <h6 class="mb-1 fw-bold {% if not notify.is_read %}text-primary{% else %}text-secondary{% endif %}">
                                {{ notify.title }}
                            </h6>
                            <small class="text-muted">{{ notify.created_at.strftime('%m-%d %H:%M') if notify.created_at }}</small>
                        </div>
                        <p class="mb-1 small text-muted" style="line-height: 1.5; word-break: break-all;">
                            {{ notify.content|striptags }}
                        </p>
                        <div class="mt-2">
                            {% if not notify.is_read %}
                            <span class="badge bg-danger-subtle text-danger border border-danger-subtle">未读</span>
                            {% else %}
                            <span class="badge bg-light text-muted border">已读</span>
                            {% endif %}
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="text-center text-muted py-5">
                <i class="bi bi-bell-slash fs-1 d-block mb-3 opacity-25"></i>
                <p>暂无通知内容</p>
            </div>
            {% endif %}
        </div>
        {% from "_pagination.html" import render_pagination %}
        {{ render_pagination(pagination, 'notification.notification_list') }}
    </div>
</div>

<style>
/* 优化PC端 hover 效果 */
.table-hover > tbody > tr:hover {
    background-color: #f8faff !important;
}


/* 手机端未读项微调背景色 */
.bg-light-blue {
    background-color: #f0f7ff !important;
}

/* 移除链接默认下划线 */
.list-group-item {
    text-decoration: none !important;
    border-left: 3px solid transparent;
}
/* 未读消息左侧加条提醒 */
.list-group-item.bg-light-blue {
    border-left: 3px solid #0d6efd;
}

/* 针对手机的分页按钮优化 */
@media (max-width: 576px) {
    .pagination-sm .page-link {
        padding: 0.5rem 0.75rem;
    }
}
</style>
{% endblock %}