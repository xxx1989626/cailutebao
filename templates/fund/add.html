{% extends "base.html" %}
{% block title %}添加资金记录{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card shadow border-0">
        <div class="card-header bg-success text-white py-3">
            <h4 class="mb-0"><i class="bi bi-currency-yen"></i> 添加财务记录</h4>
        </div>
        <div class="card-body p-4">
            <form action="{{ url_for('fund.fund_add') }}" method="POST" enctype="multipart/form-data">
                <div class="mb-4">
                    <h5 class="mb-3 text-success border-bottom pb-2">
                        <i class="bi bi-receipt"></i> 收支详情
                    </h5>
                    {% include 'fund/_partial_fund_form.html' %}
                </div>

                <div class="card bg-light border-primary my-4">
                    <div class="card-body">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="sync_asset" id="sync_asset_switch" style="cursor: pointer; transform: scale(1.2);">
                            <label class="form-check-label fw-bold text-primary ms-2" for="sync_asset_switch" style="cursor: pointer;">
                                这笔钱买资产了？(同时登记资产入库)
                            </label>
                        </div>
                        
                        <div id="asset_container" class="mt-3 shadow-sm p-4 bg-white rounded border border-primary-subtle" style="display:none;">
                            <div class="text-center text-muted py-2">
                                <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
                                正在加载资产表单...
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-success btn-lg shadow">
                        <i class="bi bi-save"></i> 提交财务记录
                    </button>
                    <a href="{{ url_for('fund.fund_list') }}" class="btn btn-link text-muted">取消返回</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('#sync_asset_switch').on('change', function() {
        if(this.checked) {
            // 加载资产表单片段
            $('#asset_container').hide().load("{{ url_for('asset.get_form_snippet') }}", function(response, status, xhr) {
                if (status == "error") {
                    alert("资产组件加载失败，请检查后端路由或网络");
                } else {
                    $(this).slideDown();
                }
            });
        } else {
            $('#asset_container').slideUp(function() {
                $(this).html('<div class="text-center text-muted py-2">正在加载资产表单...</div>');
            });
        }
    });
});
</script>
{% endblock %}