# 更新日志 (Change Log)

所有对本项目的重要变更将记录在此文件中。
Markdown格式

## [7.1.9-alpha] - 2026-01-08

### 🚀 新增功能 (Added)
- **账号自动同步**：现在“自主登记”的队员在通过管理员审批（approve_pending）后，系统会自动为其创建登录账号。

- **默认凭据生成**：自动创建的账号统一以 身份证号 为用户名，身份证后六位 为初始密码。

- **操作审计流**：在审批通过时，系统会自动记录一条 action_type='审批入职' 的审计日志到数据库中，涵盖审批人、目标对象及具体描述。

### 🛠️ 修复 (Fixed)
- **审批流程闭环**：修复了自主登记队员在审批通过后无法登录系统的逻辑漏洞。

- **状态强控：加强了审批时的状态校验，防止对非“待审核”状态的记录进行重复审批。

### 🛡️ 安全与优化 (Security & Optimization)
- **入职冲突检测**：审批前增加二次查重，防止在审批期间该身份证已通过其他渠道入职导致的重复数据。

- **异常处理：在审批提交环节增加了 try-except 捕获及 db.session.rollback() 回滚机制，确保数据库事务的一致性。

## [7.1.8-alpha] - 2026-01-08

### ✨ 新增功能 (Added)
- **床位动态统计看板**：在房间标题处新增 `已占用/总床位` 实时显示（例如：`2/6`），通过自动累加房内资产容量计算得出。
- **宿舍长置顶逻辑**：优化房间内人员列表，宿舍长（Room Leader）现在会自动排列在首位，并配有星标提醒。
- **资产-铺位联动显示**：床类资产标签右侧新增“铺位人员”面板，可直观查看上、下铺的住户姓名及空位状态。

### 🚀 布局与交互优化 (Improved)
- **全屏地图模式**：突破了 `base.html` 中 `.container` 的宽度限制，支持超大宿舍平面图的 100% 宽度显示。
- **自由缩放滚动**：为地图容器增加了 `overflow: auto`，解决了大尺寸底图在小屏幕下显示不全的问题。
- **界面层次感**：优化了资产标签的 `d-flex` 布局，使责任人信息与铺位信息在有限空间内清晰共存。

### 🐞 修复 (Fixed)
- **拖拽坐标偏移问题**：修复了在开启滚动条或父级容器偏移时，管理员移动房间位置出现的“坐标吸死”或“位置错位”现象。
- **排序冒泡干扰**：解决了 `Sortable.js` 拖拽分配功能与房间句柄 `onmousedown` 移动事件的冒泡冲突。

### 🔧 数据库与模型 (Database)
- 强化了资产模型与房间住户的关联查询，通过 `bed_number` 实现人员与具体资产个体的精确绑定。